<table class='tblSearch'>
    <tr>
        <td>Type :</td><td id='tdSelectCateg'></td>
    </tr>
    <tr>
        <td>Zone du corps :</td><td id='tdSelectZones'></td>
    </tr>
    <tr>
        <td>Difficult√© :</td><td id='tdSelectDiff'></td><td class='tdButtonClearSearch'><button class='imgButtonSmall' id='btnClearSearch'>&nbsp;</td>
    </tr>
</table>
<hr/>
<div id='divResultsExercices'></div>
<script>
    var exoPage = {
        // init page components
        initialise: () => {
            dataManager.getCategories().done((data) => {
                data.splice(0,0,new Categorie(-1,"-", "-"));
                pageManager.renderElement('selectElement', data, 'tdSelectCateg'); 
            });
            dataManager.getDifficultes().done((data) => {
                data.splice(0,0,new Difficulte(-1,"-"));
                pageManager.renderElement('selectElement', data, 'tdSelectDiff'); 
            });
            dataManager.getZones().done((data) => {
                data.splice(0,0,new Zone(-1,"-"));
                pageManager.renderElement('selectElement', data, 'tdSelectZones'); 
            });
        
            $('#btnClearSearch').click(() => {
                $('#tdSelectCateg select').val(-1);
                $('#tdSelectZones select').val(-1);
                $('#tdSelectDiff select').val(-1);
            });
        },
        // Perform exercices search 
        searchExercices: () => {
            // Search exercices
            dataManager.getExercices().done(function(listExercices) {
    
                // Get filter values
                var filterDiffId = $('#tdSelectDiff select').val()*1;
                var filterCategId = $('#tdSelectCateg select').val()*1;
                var filterZoneId = $('#tdSelectZones select').val()*1;
    
                // filter results
                var results = listExercices;
                results = filterManager.filterExercices(results, filterCategId, 'categ');
                results = filterManager.filterExercices(results, filterDiffId, 'diff');
                results = filterManager.filterExercices(results, filterZoneId, 'zone');
    
                // Display results
                pageManager.renderElement('listElement', results, 'divResultsExercices').done(function(html) {
                   // Replace ids with values
                    $('.ulResults td').each(function(){
                        var data = $(this).data();
                        if (data) {
                            if (data.categ) {
                                dataManager.getCategorie(data.categ).done((item) => {
                                   $(this).html(item.nom); 
                                });
                            }
                            if (data.diff) {
                                dataManager.getDifficulte(data.diff).done((item) => {
                                   $(this).html(item.nom); 
                                });
                            }
                        }
                    }); 
                });
            });
        }
    }
    
    exoPage.initialise();
</script>