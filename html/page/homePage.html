<div id='divHomePage'>
    <table class='tblLogin'>
        <tr>
            <td>Login</td>
            <td><input id='txtLogin'></input></td>
        </tr>
        <tr>
            <td>Password</td>
            <td><input id='txtPassword' type='password'></input></td>
        </tr>
        <tr>
            <td colspan='2' class='tdButtonLogin'>
                <button class='imgButtonSmall' id='btnCreateLogin' onclick='homePage.createLogin()'><img/></button>
                <button class='imgButtonSmall [{profileManager.getLoginStatus()}]' id='btnValidateLogin' onclick='homePage.validateLogin()'><img/></button>
            </td>
        </tr>
        <tr>
            <td class='tdMessageLogin'></td>
            <td></td>
        </tr>
    </table>
</div>
<script>
    var homePage = {
        showPopinSettings: () => {
            let data = profileManager.getDetailedProfiles();
            popinManager.load('OK').done(() => {
                pageManager.renderElement('settings/settingsPage', data, 'tdPopinContent').done(() => {
                    popinManager.show(); 
                });
            });
        },
        settingsExportAllData: () => {
            let currentProfile = profileManager.getProfiles();
            let encodedProfile = JSON.stringify(currentProfile);
            encodedProfile = btoa(encodedProfile);
            let html = "<textarea id='txtSettingsData'>" + encodedProfile + "</textarea><br/><button onclick='homePage.closeSettingsData()'>Fermer</button>";
            $('#divSettingsData').html(html);
        },
        settingsDeleteAllData: () => {
            popinManager.setCallbackFunction('homePage.validateSettingsDeleteAllData()');
            popinManager.showConfirmation("Voulez-vous supprimer toutes les données ?");
        },
        validateSettingsDeleteAllData: () => {
            window.localStorage.removeItem('wodProfiles');
            window.localStorage.removeItem('currentWodProfile');
            pageManager.navigateTo('home');
        },
        closeSettingsData: () => {
            $('#divSettingsData').html("");
        },
        settingsImportAllData: () => {
            let html = "<textarea id='txtSettingsData'></textarea><br/><button onclick='homePage.validateImportAllData()'>Valider</button>&nbsp;<button onclick='homePage.closeSettingsData()'>Fermer</button>";
            $('#divSettingsData').html(html);
        },
        validateImportAllData: () => {
            let importedValue = $('#txtSettingsData').val();
            profileManager.restoreProfiles(importedValue).done((val) => {
                $('#divSettingsData').html(val + " profils importés avec succès");
            }).fail((erreur) => {
                $('#divSettingsData').html("Erreur : " + erreur);
            });
        },
        validateLogin: () => {
            // connect
            if ($(".disconnected").length>0) {
                let login = $('#txtLogin').val();
                let pwd = $('#txtPassword').val();
                profileManager.connectProfile(login, pwd).done(() => {
                    $('#txtLogin').val('');
                    $('#txtPassword').val('');
                    $(".tdMessageLogin").html('Connecté');
                    $('#btnValidateLogin').toggleClass(['connected','disconnected']);
                }).fail((erreur) => {
                    $(".tdMessageLogin").html(erreur);
                });   
            }
            else {
                // disconnect
                profileManager.disconnectProfile();
                $(".tdMessageLogin").html('Déconnecté');
                $('#btnValidateLogin').toggleClass(['connected','disconnected']);
            }
        },
        createLogin: () => {
            let login = $('#txtLogin').val();
            let pwd = $('#txtPassword').val();
            profileManager.createNewProfile(login, pwd).done(() => {
                $(".tdMessageLogin").html('Profil créé avec succès');
                $('#txtLogin').val('');
                $('#txtPassword').val('');
            }).fail((erreur) => {
                $(".tdMessageLogin").html(erreur);
            });
        }
    }
</script>